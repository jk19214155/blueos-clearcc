     1 00000000                                 ; BMP decode routine by I.Tak. 2003
     2 00000000                                 
     3 00000000                                 section .text align=1
      >> [ERROR #001] syntax error.
     4 00000000                                 [bits 32]
     5 00000000                                 ;BMP File Structure (I can't understand MS.)
     6 00000000                                 
     7 00000000                                 	struc BMP
      >> [ERROR #001] syntax error.
     8 00000000                                 		;FILE HEADER
     9 00000000 0000                            .fType:		resw 1	;BM
    10 00000002 00000000                        .fSize:		resd 1	;whole file size
    11 00000006 00000000                        		resd 1	;reserved
    12 0000000A 00000000                        .fOffBits:	resd 1	;offset from file top to image
    13 0000000E                                 		;INFO HEADER
    14 0000000E 00000000                        .iSize:		resd 1	;INFO HEADER size
    15 00000012 00000000                        .iWidth:	resd 1	;Image Width in pixels
    16 00000016 00000000                        .iHeight:	resd 1	;Image Height in pixels
    17 0000001A 0000                            .iPlanes:	resw 1	;must be 1
    18 0000001C 0000                            .iBitCount:	resw 1	;BitPerPixel 1, 4, 8, 24 (and 15,16 for new OS/2 ?)
    19 0000001E 00000000                        .iCompression:	resd 1	;Compress Type. 0 for none, then SizeImage=0
    20 00000022 00000000                        .iSizeImage:	resd 1	;Image Size(compressed)
    21 00000026 00000000                        .iXPPM:		resd 1	;X Pixel Per Meter
    22 0000002A 00000000                        .iYPPM:		resd 1
    23 0000002E 00000000                        .iClrUsed:	resd 1	;Number of used ColorQuad (0 for whole Quad)
    24 00000032 00000000                        .iClrImportant:	resd 1	;Number of Important ColorQuad.
    25 00000036                                 	endstruc
    26 00000036                                 
    27 00000036                                 	struc BMPOS2
      >> [ERROR #007] label definition error.
    28 00000036                                 		;FILE HEADER
    29 00000036 0000                            .fType:		resw 1	;BM
    30 00000038 00000000                        .fSize:		resd 1	;whole file size
    31 0000003C 00000000                        		resd 1	;reserved
    32 00000040 00000000                        .fOffBits:	resd 1	;offset from file top to image
    33 00000044                                 		;CORE HEADER
    34 00000044 00000000                        .iSize:		resd 1	;CORE HEADER size
    35 00000048 0000                            .iWidth:	resw 1	;Image Width in pixels
    36 0000004A 0000                            .iHeight:	resw 1	;Image Height in pixels
    37 0000004C 0000                            .iPlanes:	resw 1	;must be 1
    38 0000004E 0000                            .iBitCount:	resw 1	;BitPerPixel 1, 4, 8, 24 (and 15,16 for new OS/2 ?)
    39 00000050                                 	endstruc
      >> [ERROR #007] label definition error.
    40 00000050                                 
    41 00000050                                 ; B/W bmp can also have palettes. The first for 0, second for 1.
    42 00000050                                 
    43 00000050                                 	struc CQuad
      >> [ERROR #007] label definition error.
    44 00000050 00                              .b:	resb 1
    45 00000051 00                              .g:	resb 1
    46 00000052 00                              .r:	resb 1
    47 00000053 00                              	resb 1	;reserved
    48 00000054                                 	endstruc
      >> [ERROR #007] label definition error.
    49 00000054                                 
    50 00000054                                 
    51 00000054                                 %if 0
      >> [ERROR #001] syntax error.
    52 00000054                                 int info_BMP(struct DLL_STRPICENV *env, int *info, int size, UCHAR *fp);
      >> [ERROR #002] parameter error.
    53 00000054                                 
    54 00000054                                 int decode0_BMP(struct DLL_STRPICENV *env, int size, UCHAR *fp,
      >> [ERROR #002] parameter error.
    55 00000054                                                 int b_type, UCHAR *buf, int skip);
      >> [ERROR #002] parameter error.
    56 00000054                                 %endif
    57 00000054                                 
    58 00000054                                 [absolute 0]	;naskなら[section .bss] org 0 かな win32だからダメか
      >> [ERROR #001] syntax error.
    59 00000054                                 bmpinfo:
    60 00000054 00000000 00000000 00000000      .regs:		resd 4
       00000060 00000000 
    61 00000064 00000000                        .reteip:	resd 1
    62 00000068 00000000                        .env:		resd 1
    63 0000006C 00000000                        .info:		resd 1
    64 00000070 00000000                        .size:		resd 1
    65 00000074 00000000                        .module:	resd 1
    66 00000078                                 [absolute 0]
      >> [ERROR #001] syntax error.
    67 00000078                                 info:
    68 00000078 00000000                        .type:		resd 1	;1 for BMP, 2 for JPEG
    69 0000007C 00000000                        		resd 1	;0
    70 00000080 00000000                        .width:		resd 1
    71 00000084 00000000                        .height:	resd 1
    72                                          [section .text]
    73 00000000                                 [global  _info_BMP]
      >> [ERROR #001] syntax error.
    74 00000000                                 _info_BMP:
    75 00000000 6A 00                           	push ebx
      >> [ERROR #012] expression error.
    76 00000002 6A 00                           	push ebp
      >> [ERROR #012] expression error.
    77 00000004 6A 00                           	push esi
      >> [ERROR #012] expression error.
    78 00000006 6A 00                           	push edi
      >> [ERROR #012] expression error.
    79 00000008                                 	mov esi, [esp+bmpinfo.module]
      >> [ERROR #004] data type error.
    80 00000008                                 	mov eax, [esp+bmpinfo.size]
      >> [ERROR #004] data type error.
    81 00000008 E8 00000003                     	call bmpHeader
    82 0000000D                                 	test edi, edi
      >> [ERROR #004] data type error.
    83 0000000D 74 00                           	jz .ret
    84 0000000F                                 	mov esi, [esp+bmpinfo.info]
      >> [ERROR #004] data type error.
    85 0000000F                                 	mov [esi+info.width], eax
      >> [ERROR #003] data size error.
    86 0000000F                                 	mov [esi+info.height], ecx
      >> [ERROR #003] data size error.
    87 0000000F                                 	mov [esi+info.type], edi	;=1
      >> [ERROR #003] data size error.
    88 0000000F                                 	dec edi
      >> [ERROR #002] parameter error.
    89 0000000F                                 	mov [esi+info.type+4], edi	;=0
      >> [ERROR #003] data size error.
    90 0000000F                                 	inc edi
      >> [ERROR #002] parameter error.
    91 0000000F                                 .ret:	mov eax, edi
      >> [ERROR #003] data size error.
    92 0000000F                                 	pop edi
      >> [ERROR #002] parameter error.
    93 0000000F                                 	pop esi
      >> [ERROR #002] parameter error.
    94 0000000F                                 	pop ebp
      >> [ERROR #002] parameter error.
    95 0000000F                                 	pop ebx
      >> [ERROR #002] parameter error.
    96 0000000F C3                              	ret
    97 00000010                                 
    98 00000010                                 ;in: esi=module, eax=size
    99 00000010                                 ;ret:eax=width, ecx=hegiht, edx=paletteSize, ebx=palette
   100 00000010                                 ;    ebp=bpp, esi=endOfImage, edi=successFlag
   101 00000010                                 bmpHeader:
   102 00000010                                 	lea edx, [esi+eax]		;moduleEnd
      >> [ERROR #004] data type error.
   103 00000010                                 	xor edi, edi
      >> [ERROR #003] data size error.
   104 00000010 6A 00                           	push edx
      >> [ERROR #012] expression error.
   105 00000012                                 	xor edx, edx
      >> [ERROR #003] data size error.
   106 00000012                                 
   107 00000012                                 	cmp eax, byte BMP.iSize+4
      >> [ERROR #003] data size error.
   108 00000012 76 0D                           	jbe ..@ret			;中継してしまう
   109 00000014 66 81 3D 00000000 4D42          	cmp word[esi],'BM'
      >> [ERROR #012] expression error.
   110 0000001D 74 0F                           	je .notMAC
   111 0000001F                                 	sub esi, byte -128
      >> [ERROR #003] data size error.
   112 0000001F                                 	add eax, byte -128
      >> [ERROR #003] data size error.
   113 0000001F                                 	pop ebx
      >> [ERROR #002] parameter error.
   114 0000001F 6A 00                           	push eax
      >> [ERROR #012] expression error.
   115 00000021                                 	cmp eax, byte BMP.iSize+4
      >> [ERROR #003] data size error.
   116 00000021 76 DD                           ..@ret:	jbe .ret
      >> [ERROR #012] expression error.
   117 00000023 66 81 3D 00000000 4D42          	cmp word[esi], 'BM'
      >> [ERROR #012] expression error.
   118 0000002C 75 D2                           	jne .ret
      >> [ERROR #012] expression error.
   119 0000002E                                 .notMAC:
   120 0000002E                                 	;;MS,OS/2 フォーマット確認
   121 0000002E                                 	mov ecx, [esi +BMP.iSize]
      >> [ERROR #004] data type error.
   122 0000002E                                 	cmp ecx, byte 12			;OS/2 format.
      >> [ERROR #003] data size error.
   123 0000002E 75 D0                           	jne .MS
      >> [ERROR #012] expression error.
   124 00000030                                 	  cmp eax, byte BMPOS2_size
      >> [ERROR #003] data size error.
   125 00000030 76 CE                           	  jbe .ret				;core
      >> [ERROR #012] expression error.
   126 00000032                                 	  lea ebx, [esi+ecx+14]			;palette
      >> [ERROR #004] data type error.
   127 00000032                                 	  movzx eax, word[esi+BMPOS2.iWidth]	;width
      >> [ERROR #001] syntax error.
   128 00000032                                 	  movzx ecx, word[esi+BMPOS2.iHeight]	;height
      >> [ERROR #007] label definition error.
   129 00000032                                 	  movzx ebp, word[esi+BMPOS2.iBitCount]	;bpp
      >> [ERROR #007] label definition error.
   130 00000032 B2 03                           	  mov dl, 3				;paletteSize
   131 00000034 EB 08                           	jmp short .endif
   132 00000036                                 .MS:	  cmp eax, byte BMP_size
      >> [ERROR #003] data size error.
   133 00000036 76 10                           	  jbe .ret				;infoヘッダなし
   134 00000038                                 	  lea ebx, [esi+ecx+14]
      >> [ERROR #004] data type error.
   135 00000038                                 	  sub ecx,byte 40
      >> [ERROR #003] data size error.
   136 00000038 75 0E                           	  jne .ret				;unknownFormat
   137 0000003A                                 	  cmp ecx, [esi+BMP.iCompression]
      >> [ERROR #004] data type error.
   138 0000003A 75 0C                           	  jne .ret				;Compressed.
   139 0000003C                                 	  mov   eax, [esi+BMP.iWidth]		;width
      >> [ERROR #004] data type error.
   140 0000003C                                 	  mov   ecx, [esi+BMP.iHeight]		;height
      >> [ERROR #004] data type error.
   141 0000003C                                 	  movzx ebp, word[esi +BMP.iBitCount]	;bpp
      >> [ERROR #007] label definition error.
   142 0000003C B2 04                           	  mov dl, 4				;paletteSize
   143 0000003E                                 .endif:
   144 0000003E                                 	add esi, [esi +BMP.fOffBits]
      >> [ERROR #004] data type error.
   145 0000003E                                 
   146 0000003E 6A 00                           	push edx
      >> [ERROR #012] expression error.
   147 00000040 6A 00                           	push eax
      >> [ERROR #012] expression error.
   148 00000042                                 	mul ebp				;eax=width*bpp
      >> [ERROR #004] data type error.
   149 00000042                                 	add eax, byte 7
      >> [ERROR #003] data size error.
   150 00000042                                 	shr eax, 3			;lineSizeWithoutPudding
      >> [ERROR #004] data type error.
   151 00000042                                 	mov edx, eax
      >> [ERROR #003] data size error.
   152 00000042                                 	add eax, byte 3			;size<1GBを仮定してedxを無
      >> [ERROR #003] data size error.
   153 00000042 24 FC                           	and al, -4			;lineSizeWithPudding
   154 00000044                                 	sub edx, eax			;-puddingSize
      >> [ERROR #003] data size error.
   155 00000044 6A 00                           	push edx
      >> [ERROR #012] expression error.
   156 00000046                                 	mul ecx
      >> [ERROR #004] data type error.
   157 00000046                                 	pop edx
      >> [ERROR #002] parameter error.
   158 00000046                                 	add esi, eax
      >> [ERROR #003] data size error.
   159 00000046                                 	add esi, edx			;最終行の最後にはpuddingがないと見るべき
      >> [ERROR #003] data size error.
   160 00000046                                 	cmp esi, [esp+8]		;endOfModule
      >> [ERROR #004] data type error.
   161 00000046                                 	pop eax
      >> [ERROR #002] parameter error.
   162 00000046 77 00                           	ja .ret2
   163 00000048                                 	sub esi, edx			;esi=endOfImage
      >> [ERROR #003] data size error.
   164 00000048                                 	inc edi				;succeeded!
      >> [ERROR #002] parameter error.
   165 00000048                                 .ret2:	pop edx
      >> [ERROR #002] parameter error.
   166 00000048                                 .ret:	add esp, byte 4
      >> [ERROR #003] data size error.
   167 00000048 C3                              	ret
   168 00000049                                 
   169 00000049                                 ;***************************************************************
   170 00000049                                 ; 小ささ優先で作っているが, 速さ優先で作った昔のよりいいかも。
   171 00000049                                 ; 品質最低の高速モードのみ作ってい
   172 00000049                                 
   173 00000049                                 [absolute 0]
      >> [ERROR #001] syntax error.
   174 00000049                                 decode:
   175 00000049 00000000 00000000 00000000      .regs:		resd 4
       00000055 00000000 
   176 00000059 00000000                        .reteip:	resd 1
   177 0000005D 00000000                        .env:		resd 1
   178 00000061 00000000                        .size:		resd 1
   179 00000065 00000000                        .module:	resd 1
   180 00000069 00000000                        .outputType:	resd 1
   181 0000006D 00000000                        .dest:		resd 1
   182 00000071 00000000                        .skip:		resd 1
   183                                          [section .text]
   184 00000075                                 [global _decode0_BMP]
      >> [ERROR #001] syntax error.
   185 00000075                                 _decode0_BMP:
   186 00000075 6A 00                           	push ebx
      >> [ERROR #012] expression error.
   187 00000077 6A 00                           	push ebp
      >> [ERROR #012] expression error.
   188 00000079 6A 00                           	push esi
      >> [ERROR #012] expression error.
   189 0000007B 6A 00                           	push edi
      >> [ERROR #012] expression error.
   190 0000007D                                 	mov esi, [esp+decode.module]
      >> [ERROR #004] data type error.
   191 0000007D                                 	mov eax, [esp+decode.size]
      >> [ERROR #004] data type error.
   192 0000007D E8 FFFFFF8E                     	call bmpHeader
   193 00000082                                 	;ret:eax=width, ecx=hegiht, edx=paletteSize, ebx=palette
   194 00000082                                 	;    ebp=bpp, esi=endOfImage, edi=successFlag
   195 00000082                                 	test edi,edi
      >> [ERROR #004] data type error.
   196 00000082 74 1D                           	jz .error
   197 00000084                                 	mov edi, [esp+decode.dest]
      >> [ERROR #004] data type error.
   198 00000084 FF 35 00000069                  	push dword[esp+decode.outputType]
      >> [ERROR #012] expression error.
   199 0000008A FF 35 00000075                  	push dword[esp+4+decode.skip]
      >> [ERROR #012] expression error.
   200 00000090 6A 00                           	push ecx			;height
      >> [ERROR #012] expression error.
   201 00000092 6A 00                           	push eax
      >> [ERROR #012] expression error.
   202 00000094 6A 00                           	push edx
      >> [ERROR #012] expression error.
   203 00000096                                 	mul ebp
      >> [ERROR #004] data type error.
   204 00000096                                 	add eax, byte 31
      >> [ERROR #003] data size error.
   205 00000096                                 	shr eax, 3
      >> [ERROR #004] data type error.
   206 00000096 24 FC                           	and al, -4
   207 00000098 6A 00                           	push eax
      >> [ERROR #012] expression error.
   208 0000009A                                 	mov edx, ebp
      >> [ERROR #003] data size error.
   209 0000009A                                 	mov ebp, esp
      >> [ERROR #003] data size error.
   210 0000009A E8 00000025                     	call bmp2beta			;ecx!=0 for error
   211 0000009F                                 	add esp, byte bb.size
      >> [ERROR #003] data size error.
   212 0000009F                                 	mov eax, ecx
      >> [ERROR #003] data size error.
   213 0000009F                                 	test ecx, ecx
      >> [ERROR #004] data type error.
   214 0000009F 74 02                           	jz .ret
   215 000000A1 6A 01                           .error:	push byte 1
   216 000000A3                                 	pop eax
      >> [ERROR #002] parameter error.
   217 000000A3                                 .ret:	pop edi
      >> [ERROR #002] parameter error.
   218 000000A3                                 	pop esi
      >> [ERROR #002] parameter error.
   219 000000A3                                 	pop ebp
      >> [ERROR #002] parameter error.
   220 000000A3                                 	pop ebx
      >> [ERROR #002] parameter error.
   221 000000A3 C3                              	ret
   222 000000A4                                 
   223 000000A4                                 [absolute -4*2]
      >> [ERROR #001] syntax error.
   224 000000A4                                 bb:
   225 000000A4 00000000                        .col0:		resd 1	;bpp1で使う
   226 000000A8 00000000                        .reteip:	resd 1
   227 000000AC 00000000                        .sw:		resd 1	;byte
   228 000000B0 00000000                        .paletteSize:	resd 1	;byte
   229 000000B4 00000000                        .w:		resd 1	;pixel
   230 000000B8 00000000                        .h:		resd 1
   231 000000BC 00000000                        .s:		resd 1
   232 000000C0 00000000                        .t:		resd 1
   233  = 000000C4                              .size: equ $-$$
   234                                          [section .text]
   235 000000C4                                 ;eax=?, ecx=height, edx=bpp, ebx=palette
   236 000000C4                                 ;ebp=bb, esi=endOfImage, edi=dest
   237 000000C4                                 bmp2beta:
   238 000000C4 A0 000000C0                     	mov al, [ebp+bb.t]
      >> [ERROR #012] expression error.
   239 000000C9 24 7F                           	and al, 0x7f
   240 000000CB 3C 02                           	cmp al, 2
   241 000000CD 0F 84 00000087                  	je near buf16
   242 000000D3 3C 04                           	cmp al, 4
   243 000000D5 74 01                           	je buf32
   244 000000D7                                 	mov ecx, esp		;!=0
      >> [ERROR #003] data size error.
   245 000000D7 C3                              	ret
   246 000000D8                                 ;===============================================================
   247 000000D8                                 ;	Buffer mode 4
   248 000000D8                                 ;===============================================================
   249 000000D8                                 buf32:
   250 000000D8                                 	dec edx
      >> [ERROR #002] parameter error.
   251 000000D8 0F 84 00000063                  	je near .bpp1
   252 000000DE                                 	sub edx, byte 4-1
      >> [ERROR #003] data size error.
   253 000000DE 74 46                           	je .bpp4
   254 000000E0                                 	sub edx, byte 8-4
      >> [ERROR #003] data size error.
   255 000000E0 74 30                           	je .bpp8
   256 000000E2                                 	sub edx, byte 24-8
      >> [ERROR #003] data size error.
   257 000000E2 74 01                           	je .bpp24
   258 000000E4                                 	mov ecx, esp		;!=0
      >> [ERROR #003] data size error.
   259 000000E4 C3                              	ret
   260 000000E5                                 ;---------------------------------------------------
   261 000000E5                                 ;	24bpp BMP to 4byte bufer
   262 000000E5                                 ;---------------------------------------------------
   263 000000E5                                 .bpp24:
   264 000000E5                                 	;ecx=height, edx=0, ebx=palette
   265 000000E5                                 	;esi=endOfImage, edi=destinationBuffer
   266 000000E5                                 	;bb.w=width(pixel), bb.s=skipByte, bb.h=height
   267 000000E5                                 	;bb.t=outputType, bb.sw=sourceWidthByte
   268 000000E5                                 
   269 000000E5                                 	.do24.1:
   270 000000E5                                 	  sub esi, [ebp+bb.sw]	;esi=startOfLine
      >> [ERROR #004] data type error.
   271 000000E5 6A 00                           	  push ecx
      >> [ERROR #012] expression error.
   272 000000E7 6A 00                           	  push esi
      >> [ERROR #012] expression error.
   273 000000E9                                 	  mov ecx, [ebp+bb.w]
      >> [ERROR #004] data type error.
   274 000000E9                                 	  .do24.2:
   275 000000E9 A0 00000000                     	    mov al, [esi]
      >> [ERROR #012] expression error.
   276 000000EE 88 15 00000003                  	     mov [edi+3], dl
      >> [ERROR #012] expression error.
   277 000000F4 A2 00000000                     	    mov [edi], al
      >> [ERROR #012] expression error.
   278 000000F9 A0 00000001                     	     mov al, [esi+1]
      >> [ERROR #012] expression error.
   279 000000FE A2 00000001                     	    mov [edi+1], al
      >> [ERROR #012] expression error.
   280 00000103 A0 00000002                     	     mov al, [esi+2]
      >> [ERROR #012] expression error.
   281 00000108 A2 00000002                     	    mov [edi+2], al
      >> [ERROR #012] expression error.
   282 0000010D                                 	     add esi, byte 3
      >> [ERROR #003] data size error.
   283 0000010D                                 	    add edi, byte 4
      >> [ERROR #003] data size error.
   284 0000010D                                 	     dec ecx
      >> [ERROR #002] parameter error.
   285 0000010D 75 DA                           	  jnz .do24.2
   286 0000010F                                 	  pop esi
      >> [ERROR #002] parameter error.
   287 0000010F                                 	  pop ecx
      >> [ERROR #002] parameter error.
   288 0000010F                                 	  add edi, [ebp+bb.s]
      >> [ERROR #004] data type error.
   289 0000010F                                 	  dec ecx
      >> [ERROR #002] parameter error.
   290 0000010F 75 D4                           	jnz .do24.1
   291 00000111 C3                              	ret
   292 00000112                                 
   293 00000112                                 ;---------------------------------------------------
   294 00000112                                 ;	8bpp BMP to 4byte buffer
   295 00000112                                 ;---------------------------------------------------
   296 00000112                                 .bpp8:
   297 00000112                                 	;ecx=height, edx=0, ebx=palette
   298 00000112                                 	;esi=endOfImage, edi=destinationBuffer
   299 00000112                                 
   300 00000112                                 	;pallete変換
   301 00000112 B2 FF                           	mov dl, 255
   302 00000114                                 	mov eax, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   303 00000114                                 	sub ebx, eax
      >> [ERROR #003] data size error.
   304 00000114                                 	shl eax, 8
      >> [ERROR #004] data type error.
   305 00000114                                 	add ebx, eax		;ebx += paletteSize*255
      >> [ERROR #003] data size error.
   306 00000114                                 	.do8.1:
   307 00000114                                 	  mov eax, [ebx]
      >> [ERROR #004] data type error.
   308 00000114                                 	  sub ebx, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   309 00000114                                 	  and eax, 0x00ffffff
      >> [ERROR #003] data size error.
   310 00000114                                 	  dec edx
      >> [ERROR #002] parameter error.
   311 00000114 6A 00                           	  push eax
      >> [ERROR #012] expression error.
   312 00000116 79 FC                           	jns .do8.1
   313 00000118                                 
   314 00000118                                 	.do8.2:
   315 00000118                                 	  sub esi, [ebp+bb.sw]	;esi=firstLineStart
      >> [ERROR #004] data type error.
   316 00000118 6A 00                           	  push ecx
      >> [ERROR #012] expression error.
   317 0000011A 6A 00                           	  push esi
      >> [ERROR #012] expression error.
   318 0000011C                                 	  mov ecx, [ebp+bb.w]
      >> [ERROR #004] data type error.
   319 0000011C                                 	  .do8.3:
   320 0000011C                                 	    xor eax, eax
      >> [ERROR #003] data size error.
   321 0000011C                                 	     add edi, byte 4
      >> [ERROR #003] data size error.
   322 0000011C A0 00000000                     	    mov al, [esi]
      >> [ERROR #012] expression error.
   323 00000121                                 	     inc esi
      >> [ERROR #002] parameter error.
   324 00000121                                 	    ;AGI stole
   325 00000121                                 	    mov eax, [esp+eax*4+8]
      >> [ERROR #004] data type error.
   326 00000121                                 	     dec ecx
      >> [ERROR #002] parameter error.
   327 00000121                                 	    mov [edi-4], eax
      >> [ERROR #003] data size error.
   328 00000121 75 F9                           	  jnz .do8.3
   329 00000123                                 	  pop esi
      >> [ERROR #002] parameter error.
   330 00000123                                 	  pop ecx
      >> [ERROR #002] parameter error.
   331 00000123                                 	  add edi, [ebp+bb.s]
      >> [ERROR #004] data type error.
   332 00000123                                 	  dec ecx
      >> [ERROR #002] parameter error.
   333 00000123 75 F3                           	jnz .do8.2
   334 00000125                                 	add esp, 256*4		;palette
      >> [ERROR #003] data size error.
   335 00000125 C3                              	ret
   336 00000126                                 
   337 00000126                                 ;---------------------------------------------------
   338 00000126                                 ;	4bpp BMP to 4byte buffer
   339 00000126                                 ;---------------------------------------------------
   340 00000126                                 .bpp4:
   341 00000126                                 	;ecx=height, edx=0, ebx=palette
   342 00000126                                 	;esi=endOfImage, edi=destinationBuffer
   343 00000126                                 
   344 00000126                                 	;pallete変換
   345 00000126 B2 10                           	mov dl, 16
   346 00000128                                 	mov eax, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   347 00000128                                 	sub ebx, eax
      >> [ERROR #003] data size error.
   348 00000128                                 	shl eax, 4
      >> [ERROR #004] data type error.
   349 00000128                                 	add ebx, eax			;ebx+=eax*15
      >> [ERROR #003] data size error.
   350 00000128                                 	.do4.1
   351 00000128                                 	  mov eax, [ebx]
      >> [ERROR #004] data type error.
   352 00000128                                 	  sub ebx, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   353 00000128                                 	  and eax, 0x00ffffff
      >> [ERROR #003] data size error.
   354 00000128                                 	  dec edx
      >> [ERROR #002] parameter error.
   355 00000128 6A 00                           	  push eax
      >> [ERROR #012] expression error.
   356 0000012A 75 FC                           	jnz .do4.1
   357 0000012C                                 
   358 0000012C                                 	.do4.2:
   359 0000012C                                 	  sub esi, [ebp+bb.sw]	;esi=firstLineStart
      >> [ERROR #004] data type error.
   360 0000012C 6A 00                           	  push ecx
      >> [ERROR #012] expression error.
   361 0000012E 6A 00                           	  push esi
      >> [ERROR #012] expression error.
   362 00000130                                 	  mov ecx, [ebp+bb.w]
      >> [ERROR #004] data type error.
   363 00000130                                 	  .do4.3:
   364 00000130                                 	    xor edx, edx
      >> [ERROR #003] data size error.
   365 00000130 A0 00000000                     	     mov al, [esi]
      >> [ERROR #012] expression error.
   366 00000135 88 C2                           	    mov dl, al
   367 00000137                                 	     inc esi
      >> [ERROR #002] parameter error.
   368 00000137 C0 EA 04                        	    shr dl, 4
   369 0000013A                                 	     and eax, byte 15
      >> [ERROR #003] data size error.
   370 0000013A                                 	    add edi, byte 4
      >> [ERROR #003] data size error.
   371 0000013A                                 	     dec ecx
      >> [ERROR #002] parameter error.
   372 0000013A                                 	    mov edx, [esp+edx*4+8]
      >> [ERROR #004] data type error.
   373 0000013A                                 	     mov eax, [esp+eax*4+8]
      >> [ERROR #004] data type error.
   374 0000013A                                 	    mov [edi-4], edx
      >> [ERROR #003] data size error.
   375 0000013A 74 02                           	     jz .wend
   376 0000013C                                 	    mov [edi], eax
      >> [ERROR #003] data size error.
   377 0000013C                                 	     add edi, byte 4
      >> [ERROR #003] data size error.
   378 0000013C                                 	    dec ecx
      >> [ERROR #002] parameter error.
   379 0000013C 75 F2                           	  jnz .do4.3
   380 0000013E                                 .wend:	  pop esi
      >> [ERROR #002] parameter error.
   381 0000013E                                 	  pop ecx
      >> [ERROR #002] parameter error.
   382 0000013E                                 	  add edi, [ebp+bb.s]
      >> [ERROR #004] data type error.
   383 0000013E                                 	  dec ecx
      >> [ERROR #002] parameter error.
   384 0000013E 75 EC                           	jnz .do4.2
   385 00000140                                 	add esp, 16*4		;palette
      >> [ERROR #003] data size error.
   386 00000140 C3                              	ret
   387 00000141                                 
   388 00000141                                 ;---------------------------------------------------
   389 00000141                                 ;	1bpp BMP to 4byte buffer
   390 00000141                                 ;---------------------------------------------------
   391 00000141                                 .bpp1:
   392 00000141                                 	;ecx=height, edx=0, ebx=palette
   393 00000141                                 	;esi=endOfImage, edi=destinationBuffer
   394 00000141                                 
   395 00000141                                 	;pallete変換
   396 00000141                                 	mov eax, [ebx]
      >> [ERROR #004] data type error.
   397 00000141                                 	add ebx, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   398 00000141                                 	and eax, 0x00ffffff
      >> [ERROR #003] data size error.
   399 00000141                                 	mov ebx, [ebx]
      >> [ERROR #004] data type error.
   400 00000141                                 	and ebx, 0x00ffffff
      >> [ERROR #003] data size error.
   401 00000141                                 	xor ebx, eax
      >> [ERROR #003] data size error.
   402 00000141                                 	;push ebx
   403 00000141 6A 00                           	push eax
      >> [ERROR #012] expression error.
   404 00000143                                 
   405 00000143                                 	.do1.1:
   406 00000143                                 	  sub esi, [ebp+bb.sw]	;esi=firstLineStart
      >> [ERROR #004] data type error.
   407 00000143 6A 00                           	  push ecx
      >> [ERROR #012] expression error.
   408 00000145 6A 00                           	  push esi
      >> [ERROR #012] expression error.
   409 00000147                                 	  mov ecx, [ebp+bb.w]
      >> [ERROR #004] data type error.
   410 00000147                                 	  .do1.2:
   411 00000147 8A 15 00000000                  	    mov dl, [esi]
      >> [ERROR #012] expression error.
   412 0000014D                                 	     inc esi
      >> [ERROR #002] parameter error.
   413 0000014D 6A 00                           	    push esi
      >> [ERROR #012] expression error.
   414 0000014F                                 	     mov esi, 8
      >> [ERROR #003] data size error.
   415 0000014F                                 	    .do1.3:
   416 0000014F                                 	      add edi, byte 4
      >> [ERROR #003] data size error.
   417 0000014F 00 D2                           	       add dl, dl
   418 00000151                                 	      sbb eax, eax
      >> [ERROR #003] data size error.
   419 00000151                                 	      and eax, ebx
      >> [ERROR #003] data size error.
   420 00000151                                 	      xor eax, [ebp+bb.col0]
      >> [ERROR #004] data type error.
   421 00000151                                 	       dec ecx
      >> [ERROR #002] parameter error.
   422 00000151                                 	      mov [edi-4], eax
      >> [ERROR #003] data size error.
   423 00000151 74 04                           	       jz .wend1bpp
   424 00000153                                 	      dec esi
      >> [ERROR #002] parameter error.
   425 00000153 75 FA                           	    jnz .do1.3
   426 00000155                                 	    pop esi
      >> [ERROR #002] parameter error.
   427 00000155 EB F0                           	  jmp short .do1.2
   428 00000157                                 .wend1bpp:pop ecx
      >> [ERROR #001] syntax error.
   429 00000157                                 	  pop esi
      >> [ERROR #002] parameter error.
   430 00000157                                 	  pop ecx
      >> [ERROR #002] parameter error.
   431 00000157                                 	  add edi, [ebp+bb.s]
      >> [ERROR #004] data type error.
   432 00000157                                 	  dec ecx
      >> [ERROR #002] parameter error.
   433 00000157 75 EA                           	jnz .do1.1
   434 00000159                                 	pop eax
      >> [ERROR #002] parameter error.
   435 00000159 C3                              	ret
   436 0000015A                                 
   437 0000015A                                 ;===============================================
   438 0000015A                                 ;	Buffer mode 2byte
   439 0000015A                                 ;===============================================
   440 0000015A                                 buf16:
   441 0000015A                                 	dec edx
      >> [ERROR #002] parameter error.
   442 0000015A 0F 84 00000078                  	je near .bpp1
   443 00000160                                 	sub edx, byte 4-1
      >> [ERROR #003] data size error.
   444 00000160 0F 84 00000045                  	je near .bpp4
   445 00000166                                 	sub edx, byte 8-4
      >> [ERROR #003] data size error.
   446 00000166 74 24                           	je .bpp8
   447 00000168                                 	sub edx, byte 24-8
      >> [ERROR #003] data size error.
   448 00000168 74 01                           	je .bpp24
   449 0000016A                                 	mov ecx, esp
      >> [ERROR #003] data size error.
   450 0000016A C3                              	ret
   451 0000016B                                 ;---------------------------------------------------
   452 0000016B                                 ;	24bpp BMP to 2byte bufer
   453 0000016B                                 ;---------------------------------------------------
   454 0000016B                                 .bpp24:
   455 0000016B                                 	;ecx=height, edx=0, ebx=palette
   456 0000016B                                 	;esi=endOfImage, edi=destinationBuffer
   457 0000016B                                 
   458 0000016B                                 	.do24.1:
   459 0000016B                                 	  sub esi, [ebp+bb.sw]	;esi=startOfLine
      >> [ERROR #004] data type error.
   460 0000016B 6A 00                           	  push ecx
      >> [ERROR #012] expression error.
   461 0000016D 6A 00                           	  push esi
      >> [ERROR #012] expression error.
   462 0000016F                                 	  mov ecx, [ebp+bb.w]
      >> [ERROR #004] data type error.
   463 0000016F                                 	  .do24.2:
   464 0000016F A0 00000002                     	    mov al, [esi+2]
      >> [ERROR #012] expression error.
   465 00000174                                 	    shl eax, 16
      >> [ERROR #004] data type error.
   466 00000174 66 A1 00000000                  	    mov ax, [esi]
      >> [ERROR #012] expression error.
   467 0000017A                                 	     add esi, byte 3
      >> [ERROR #003] data size error.
   468 0000017A                                 	    ;減色処理 eax=24bitColor, edx=work, ecx=counter, ebx=work
   469 0000017A                                 	    ;川合さんの趣味で没ったルーチンを持ってくるもよし(ぉ
   470 0000017A                                 	    ;誤差拡散ルーチンを持ってくるもよし
   471 0000017A C0 EC 02                        	    shr ah, 2		;???????? RRRRRrrr 00GGGGGG BBBBBbbb 
   472 0000017D                                 	     inc edi
      >> [ERROR #002] parameter error.
   473 0000017D                                 	    shr eax, 3		;000????? ???RRRRR rrr00GGG GGGBBBBB
      >> [ERROR #004] data type error.
   474 0000017D 66 C1 E0 05                     	    shl ax, 5		;000????? ???RRRRR GGGGGGBB BBB00000
   475 00000181                                 	     inc edi
      >> [ERROR #002] parameter error.
   476 00000181                                 	    shr eax, 5		;00000000 ???????? RRRRRGGG GGGBBBBB
      >> [ERROR #004] data type error.
   477 00000181                                 	     dec ecx
      >> [ERROR #002] parameter error.
   478 00000181 66 A3 FFFFFFFE                  	    mov [edi-2], ax
      >> [ERROR #012] expression error.
   479 00000187 75 E6                           	  jnz .do24.2
   480 00000189                                 	  pop esi
      >> [ERROR #002] parameter error.
   481 00000189                                 	  pop ecx
      >> [ERROR #002] parameter error.
   482 00000189                                 	  add edi, [ebp+bb.s]
      >> [ERROR #004] data type error.
   483 00000189                                 	  dec ecx
      >> [ERROR #002] parameter error.
   484 00000189 75 E0                           	jnz .do24.1
   485 0000018B C3                              	ret
   486 0000018C                                 
   487 0000018C                                 ;---------------------------------------------------
   488 0000018C                                 ;	8bpp BMP to 2byte buffer
   489 0000018C                                 ;---------------------------------------------------
   490 0000018C                                 .bpp8:
   491 0000018C                                 	;ecx=height, edx=0, ebx=palette
   492 0000018C                                 	;esi=endOfImage, edi=destinationBuffer
   493 0000018C                                 
   494 0000018C                                 	;pallete変換
   495 0000018C B2 FF                           	mov dl, 255
   496 0000018E                                 	mov eax, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   497 0000018E                                 	sub ebx, eax
      >> [ERROR #003] data size error.
   498 0000018E                                 	shl eax, 8
      >> [ERROR #004] data type error.
   499 0000018E                                 	add ebx, eax		;ebx += paletteSize*255
      >> [ERROR #003] data size error.
   500 0000018E                                 	.do8.1:
   501 0000018E                                 	  mov eax, [ebx]
      >> [ERROR #004] data type error.
   502 0000018E                                 	  sub ebx, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   503 0000018E E8 00000070                     	  call .paletteConv
   504 00000193                                 	  dec edx
      >> [ERROR #002] parameter error.
   505 00000193 6A 00                           	  push eax
      >> [ERROR #012] expression error.
   506 00000195 79 F7                           	jns .do8.1
   507 00000197                                 
   508 00000197                                 	.do8.2:
   509 00000197                                 	  sub esi, [ebp+bb.sw]	;esi=firstLineStart
      >> [ERROR #004] data type error.
   510 00000197 6A 00                           	  push ecx
      >> [ERROR #012] expression error.
   511 00000199 6A 00                           	  push esi
      >> [ERROR #012] expression error.
   512 0000019B                                 	  mov ecx, [ebp+bb.w]
      >> [ERROR #004] data type error.
   513 0000019B                                 	  .do8.3:
   514 0000019B                                 	    xor eax, eax
      >> [ERROR #003] data size error.
   515 0000019B                                 	     add edi, byte 2
      >> [ERROR #003] data size error.
   516 0000019B A0 00000000                     	    mov al, [esi]
      >> [ERROR #012] expression error.
   517 000001A0                                 	     inc esi
      >> [ERROR #002] parameter error.
   518 000001A0                                 	    ;AGI stole
   519 000001A0                                 	    mov eax, [esp+eax*4+8]
      >> [ERROR #004] data type error.
   520 000001A0                                 	     dec ecx
      >> [ERROR #002] parameter error.
   521 000001A0 66 A3 FFFFFFFE                  	    mov [edi-2], ax
      >> [ERROR #012] expression error.
   522 000001A6 75 F3                           	  jnz .do8.3
   523 000001A8                                 	  pop esi
      >> [ERROR #002] parameter error.
   524 000001A8                                 	  pop ecx
      >> [ERROR #002] parameter error.
   525 000001A8                                 	  add edi, [ebp+bb.s]
      >> [ERROR #004] data type error.
   526 000001A8                                 	  dec ecx
      >> [ERROR #002] parameter error.
   527 000001A8 75 ED                           	jnz .do8.2
   528 000001AA                                 	add esp, 256*4		;palette
      >> [ERROR #003] data size error.
   529 000001AA C3                              	ret
   530 000001AB                                 
   531 000001AB                                 ;---------------------------------------------------
   532 000001AB                                 ;	4bpp BMP to 2byte buffer
   533 000001AB                                 ;---------------------------------------------------
   534 000001AB                                 .bpp4:
   535 000001AB                                 	;ecx=height, edx=0, ebx=palette
   536 000001AB                                 	;esi=endOfImage, edi=destinationBuffer
   537 000001AB                                 
   538 000001AB                                 	;pallete変換
   539 000001AB B2 10                           	mov dl, 16
   540 000001AD                                 	mov eax, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   541 000001AD                                 	sub ebx, eax
      >> [ERROR #003] data size error.
   542 000001AD                                 	shl eax, 4
      >> [ERROR #004] data type error.
   543 000001AD                                 	add ebx, eax			;ebx+=eax*15
      >> [ERROR #003] data size error.
   544 000001AD                                 	.do4.1:
   545 000001AD                                 	  mov eax, [ebx]
      >> [ERROR #004] data type error.
   546 000001AD                                 	  sub ebx, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   547 000001AD E8 00000051                     	  call .paletteConv
   548 000001B2                                 	  dec edx
      >> [ERROR #002] parameter error.
   549 000001B2 6A 00                           	  push eax
      >> [ERROR #012] expression error.
   550 000001B4 75 F7                           	jnz .do4.1
   551 000001B6                                 
   552 000001B6                                 	.do4.2:
   553 000001B6                                 	  sub esi, [ebp+bb.sw]	;esi=firstLineStart
      >> [ERROR #004] data type error.
   554 000001B6 6A 00                           	  push ecx
      >> [ERROR #012] expression error.
   555 000001B8 6A 00                           	  push esi
      >> [ERROR #012] expression error.
   556 000001BA                                 	  mov ecx, [ebp+bb.w]
      >> [ERROR #004] data type error.
   557 000001BA                                 	  .do4.3:
   558 000001BA                                 	    xor edx, edx
      >> [ERROR #003] data size error.
   559 000001BA A0 00000000                     	     mov al, [esi]
      >> [ERROR #012] expression error.
   560 000001BF 88 C2                           	    mov dl, al
   561 000001C1                                 	     inc esi
      >> [ERROR #002] parameter error.
   562 000001C1 C0 EA 04                        	    shr dl, 4
   563 000001C4                                 	     and eax, byte 15
      >> [ERROR #003] data size error.
   564 000001C4                                 	    add edi, byte 2
      >> [ERROR #003] data size error.
   565 000001C4                                 	     dec ecx
      >> [ERROR #002] parameter error.
   566 000001C4                                 	    mov edx, [esp+edx*4+8]
      >> [ERROR #004] data type error.
   567 000001C4                                 	     mov eax, [esp+eax*4+8]
      >> [ERROR #004] data type error.
   568 000001C4 66 89 15 FFFFFFFE               	    mov [edi-2], dx
      >> [ERROR #012] expression error.
   569 000001CB 74 08                           	     jz .wend
   570 000001CD 66 A3 00000000                  	    mov [edi], ax
      >> [ERROR #012] expression error.
   571 000001D3                                 	     add edi, byte 2
      >> [ERROR #003] data size error.
   572 000001D3                                 	    dec ecx
      >> [ERROR #002] parameter error.
   573 000001D3 75 E5                           	  jnz .do4.3
   574 000001D5                                 .wend:	  pop esi
      >> [ERROR #002] parameter error.
   575 000001D5                                 	  pop ecx
      >> [ERROR #002] parameter error.
   576 000001D5                                 	  add edi, [ebp+bb.s]
      >> [ERROR #004] data type error.
   577 000001D5                                 	  dec ecx
      >> [ERROR #002] parameter error.
   578 000001D5 75 DF                           	jnz .do4.2
   579 000001D7                                 	add esp, 16*4		;palette
      >> [ERROR #003] data size error.
   580 000001D7 C3                              	ret
   581 000001D8                                 
   582 000001D8                                 ;---------------------------------------------------
   583 000001D8                                 ;	1bpp BMP to 2byte buffer
   584 000001D8                                 ;---------------------------------------------------
   585 000001D8                                 .bpp1:
   586 000001D8                                 	;ecx=height, edx=0, ebx=palette
   587 000001D8                                 	;esi=endOfImage, edi=destinationBuffer
   588 000001D8                                 
   589 000001D8                                 	;pallete変換
   590 000001D8                                 	mov eax, [ebx]
      >> [ERROR #004] data type error.
   591 000001D8                                 	add ebx, [ebp+bb.paletteSize]
      >> [ERROR #004] data type error.
   592 000001D8 E8 00000026                     	call .paletteConv
   593 000001DD 6A 00                           	push eax
      >> [ERROR #012] expression error.
   594 000001DF                                 	mov eax, [ebx]
      >> [ERROR #004] data type error.
   595 000001DF E8 0000001F                     	call .paletteConv
   596 000001E4                                 	pop ebx
      >> [ERROR #002] parameter error.
   597 000001E4                                 	xchg eax, ebx
      >> [ERROR #004] data type error.
   598 000001E4                                 	xor ebx, eax
      >> [ERROR #003] data size error.
   599 000001E4 6A 00                           	push eax
      >> [ERROR #012] expression error.
   600 000001E6                                 
   601 000001E6                                 	.do1.1:
   602 000001E6                                 	  sub esi, [ebp+bb.sw]	;esi=firstLineStart
      >> [ERROR #004] data type error.
   603 000001E6 6A 00                           	  push ecx
      >> [ERROR #012] expression error.
   604 000001E8 6A 00                           	  push esi
      >> [ERROR #012] expression error.
   605 000001EA                                 	  mov ecx, [ebp+bb.w]
      >> [ERROR #004] data type error.
   606 000001EA                                 	  .do1.2:
   607 000001EA 8A 15 00000000                  	    mov dl, [esi]
      >> [ERROR #012] expression error.
   608 000001F0                                 	     inc esi
      >> [ERROR #002] parameter error.
   609 000001F0 6A 00                           	    push esi
      >> [ERROR #012] expression error.
   610 000001F2                                 	     mov esi, 8
      >> [ERROR #003] data size error.
   611 000001F2                                 	    .do1.3:
   612 000001F2 00 D2                           	      add dl, dl
   613 000001F4                                 	       inc edi
      >> [ERROR #002] parameter error.
   614 000001F4                                 	      sbb eax, eax
      >> [ERROR #003] data size error.
   615 000001F4                                 	       inc edi
      >> [ERROR #002] parameter error.
   616 000001F4                                 	      and eax, ebx
      >> [ERROR #003] data size error.
   617 000001F4                                 	      xor eax, [ebp+bb.col0]
      >> [ERROR #004] data type error.
   618 000001F4                                 	       dec ecx
      >> [ERROR #002] parameter error.
   619 000001F4 66 A3 FFFFFFFE                  	      mov [edi-2], ax
      >> [ERROR #012] expression error.
   620 000001FA 74 04                           	       jz .wend1bpp
   621 000001FC                                 	      dec esi
      >> [ERROR #002] parameter error.
   622 000001FC 75 F4                           	    jnz .do1.3
   623 000001FE                                 	    pop esi
      >> [ERROR #002] parameter error.
   624 000001FE EB EA                           	  jmp short .do1.2
   625 00000200                                 .wend1bpp:
   626 00000200                                 	  pop ecx
      >> [ERROR #002] parameter error.
   627 00000200                                 	  pop esi
      >> [ERROR #002] parameter error.
   628 00000200                                 	  pop ecx
      >> [ERROR #002] parameter error.
   629 00000200                                 	  add edi, [ebp+bb.s]
      >> [ERROR #004] data type error.
   630 00000200                                 	  dec ecx
      >> [ERROR #002] parameter error.
   631 00000200 75 E4                           	jnz .do1.1
   632 00000202                                 	pop eax
      >> [ERROR #002] parameter error.
   633 00000202 C3                              	ret
   634 00000203                                 
   635 00000203                                 .paletteConv:
   636 00000203 C0 EC 02                        	shr ah, 2
   637 00000206                                 	shr eax, 3
      >> [ERROR #004] data type error.
   638 00000206 66 C1 E0 05                     	shl ax, 5
   639 0000020A                                 	shr eax, 5
      >> [ERROR #004] data type error.
   640 0000020A C3                              	ret
