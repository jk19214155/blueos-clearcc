     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_io_in16
     7 00000000                                 	EXTERN	_io_out8
     8 00000000                                 	EXTERN	_io_sti
     9 00000000                                 	EXTERN	_io_cli
    10 00000000                                 	EXTERN	_store_cr3
    11 00000000                                 	EXTERN	_io_out16
    12 00000000                                 [FILE "acpi.c"]
    13                                          [SECTION .text]
    14 00000000                                 	GLOBAL	_checksum
    15 00000000                                 _checksum:
    16 00000000 55                              	PUSH	EBP
    17 00000001 31 C0                           	XOR	EAX,EAX
    18 00000003 89 E5                           	MOV	EBP,ESP
    19 00000005 31 D2                           	XOR	EDX,EDX
    20 00000007 53                              	PUSH	EBX
    21 00000008 8B 4D 0C                        	MOV	ECX,DWORD [12+EBP]
    22 0000000B 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
    23 0000000E 39 C8                           	CMP	EAX,ECX
    24 00000010 73 08                           	JAE	L8
    25 00000012                                 L6:
    26 00000012 02 14 18                        	ADD	DL,BYTE [EAX+EBX*1]
    27 00000015 40                              	INC	EAX
    28 00000016 39 C8                           	CMP	EAX,ECX
    29 00000018 72 F8                           	JB	L6
    30 0000001A                                 L8:
    31 0000001A 5B                              	POP	EBX
    32 0000001B 31 C0                           	XOR	EAX,EAX
    33 0000001D 5D                              	POP	EBP
    34 0000001E 84 D2                           	TEST	DL,DL
    35 00000020 0F 94 C0                        	SETE	AL
    36 00000023 C3                              	RET
    37                                          [SECTION .data]
    38 00000000                                 LC0:
    39 00000000 52 53 44 20 50 54 52 20 00      	DB	"RSD PTR ",0x00
    40                                          [SECTION .text]
    41 00000024                                 	GLOBAL	_acpi_find_rsdp
    42 00000024                                 _acpi_find_rsdp:
    43 00000024 55                              	PUSH	EBP
    44 00000025 89 E5                           	MOV	EBP,ESP
    45 00000027 57                              	PUSH	EDI
    46 00000028 56                              	PUSH	ESI
    47 00000029 53                              	PUSH	EBX
    48 0000002A BB 000E0000                     	MOV	EBX,917504
    49 0000002F                                 L16:
    50 0000002F FC                              	CLD
    51 00000030 89 DE                           	MOV	ESI,EBX
    52 00000032 BF [00000000]                   	MOV	EDI,LC0
    53 00000037 B9 00000008                     	MOV	ECX,8
    54 0000003C F3                              	REPE
    55 0000003D A6                              	CMPSB
    56 0000003E 74 17                           	JE	L19
    57 00000040                                 L12:
    58 00000040 83 C3 04                        	ADD	EBX,4
    59 00000043 81 FB 000FFFFF                  	CMP	EBX,1048575
    60 00000049 76 E4                           	JBE	L16
    61 0000004B 31 D2                           	XOR	EDX,EDX
    62 0000004D                                 L9:
    63 0000004D 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
    64 00000050 89 D0                           	MOV	EAX,EDX
    65 00000052 5B                              	POP	EBX
    66 00000053 5E                              	POP	ESI
    67 00000054 5F                              	POP	EDI
    68 00000055 5D                              	POP	EBP
    69 00000056 C3                              	RET
    70 00000057                                 L19:
    71 00000057 FF 73 14                        	PUSH	DWORD [20+EBX]
    72 0000005A 53                              	PUSH	EBX
    73 0000005B E8 FFFFFFA0                     	CALL	_checksum
    74 00000060 5A                              	POP	EDX
    75 00000061 59                              	POP	ECX
    76 00000062 84 C0                           	TEST	AL,AL
    77 00000064 89 DA                           	MOV	EDX,EBX
    78 00000066 74 D8                           	JE	L12
    79 00000068 EB E3                           	JMP	L9
    80 0000006A                                 	GLOBAL	_acpi_find_table
    81 0000006A                                 _acpi_find_table:
    82 0000006A 55                              	PUSH	EBP
    83 0000006B 89 E5                           	MOV	EBP,ESP
    84 0000006D 57                              	PUSH	EDI
    85 0000006E 56                              	PUSH	ESI
    86 0000006F 53                              	PUSH	EBX
    87 00000070 83 EC 10                        	SUB	ESP,16
    88 00000073 A1 [0000001C]                   	MOV	EAX,DWORD [_RSDT]
    89 00000078 C7 45 F0 00000000               	MOV	DWORD [-16+EBP],0
    90 0000007F 8B 58 04                        	MOV	EBX,DWORD [4+EAX]
    91 00000082 89 45 EC                        	MOV	DWORD [-20+EBP],EAX
    92 00000085 83 EB 24                        	SUB	EBX,36
    93 00000088 C1 EB 02                        	SHR	EBX,2
    94 0000008B 39 5D F0                        	CMP	DWORD [-16+EBP],EBX
    95 0000008E 7D 3B                           	JGE	L28
    96 00000090 C7 45 E8 00000000               	MOV	DWORD [-24+EBP],0
    97 00000097                                 L26:
    98 00000097 8B 55 EC                        	MOV	EDX,DWORD [-20+EBP]
    99 0000009A 8B 4D E8                        	MOV	ECX,DWORD [-24+EBP]
   100 0000009D B8 00000004                     	MOV	EAX,4
   101 000000A2 8B 7D 08                        	MOV	EDI,DWORD [8+EBP]
   102 000000A5 03 4A 24                        	ADD	ECX,DWORD [36+EDX]
   103 000000A8 FC                              	CLD
   104 000000A9 89 4D E4                        	MOV	DWORD [-28+EBP],ECX
   105 000000AC 89 CE                           	MOV	ESI,ECX
   106 000000AE 89 C1                           	MOV	ECX,EAX
   107 000000B0 F3                              	REPE
   108 000000B1 A6                              	CMPSB
   109 000000B2 0F 97 C2                        	SETA	DL
   110 000000B5 0F 92 C0                        	SETB	AL
   111 000000B8 8B 4D E4                        	MOV	ECX,DWORD [-28+EBP]
   112 000000BB 38 C2                           	CMP	DL,AL
   113 000000BD 74 0E                           	JE	L20
   114 000000BF FF 45 F0                        	INC	DWORD [-16+EBP]
   115 000000C2 83 45 E8 04                     	ADD	DWORD [-24+EBP],4
   116 000000C6 39 5D F0                        	CMP	DWORD [-16+EBP],EBX
   117 000000C9 7C CC                           	JL	L26
   118 000000CB                                 L28:
   119 000000CB 31 C9                           	XOR	ECX,ECX
   120 000000CD                                 L20:
   121 000000CD 83 C4 10                        	ADD	ESP,16
   122 000000D0 89 C8                           	MOV	EAX,ECX
   123 000000D2 5B                              	POP	EBX
   124 000000D3 5E                              	POP	ESI
   125 000000D4 5F                              	POP	EDI
   126 000000D5 5D                              	POP	EBP
   127 000000D6 C3                              	RET
   128                                          [SECTION .data]
   129 00000009                                 LC1:
   130 00000009 46 41 43 50 00                  	DB	"FACP",0x00
   131                                          [SECTION .text]
   132 000000D7                                 	GLOBAL	_init_acpi
   133 000000D7                                 _init_acpi:
   134 000000D7 55                              	PUSH	EBP
   135 000000D8 89 E5                           	MOV	EBP,ESP
   136 000000DA 56                              	PUSH	ESI
   137 000000DB 53                              	PUSH	EBX
   138 000000DC E8 FFFFFF43                     	CALL	_acpi_find_rsdp
   139 000000E1 A3 [00000018]                   	MOV	DWORD [_RSDP],EAX
   140 000000E6 85 C0                           	TEST	EAX,EAX
   141 000000E8 75 07                           	JNE	L64
   142 000000EA                                 L29:
   143 000000EA 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
   144 000000ED 5B                              	POP	EBX
   145 000000EE 5E                              	POP	ESI
   146 000000EF 5D                              	POP	EBP
   147 000000F0 C3                              	RET
   148 000000F1                                 L64:
   149 000000F1 8B 40 10                        	MOV	EAX,DWORD [16+EAX]
   150 000000F4 A3 [0000001C]                   	MOV	DWORD [_RSDT],EAX
   151 000000F9 FF 70 04                        	PUSH	DWORD [4+EAX]
   152 000000FC 50                              	PUSH	EAX
   153 000000FD E8 FFFFFEFE                     	CALL	_checksum
   154 00000102 5A                              	POP	EDX
   155 00000103 59                              	POP	ECX
   156 00000104 84 C0                           	TEST	AL,AL
   157 00000106 74 E2                           	JE	L29
   158 00000108 68 [00000009]                   	PUSH	LC1
   159 0000010D E8 FFFFFF58                     	CALL	_acpi_find_table
   160 00000112 A3 [00000020]                   	MOV	DWORD [_FADT],EAX
   161 00000117 FF 70 04                        	PUSH	DWORD [4+EAX]
   162 0000011A 50                              	PUSH	EAX
   163 0000011B E8 FFFFFEE0                     	CALL	_checksum
   164 00000120 83 C4 0C                        	ADD	ESP,12
   165 00000123 84 C0                           	TEST	AL,AL
   166 00000125 74 C3                           	JE	L29
   167 00000127 A1 [00000020]                   	MOV	EAX,DWORD [_FADT]
   168 0000012C FF 70 40                        	PUSH	DWORD [64+EAX]
   169 0000012F E8 [00000000]                   	CALL	_io_in16
   170 00000134 5E                              	POP	ESI
   171 00000135 83 E0 01                        	AND	EAX,1
   172 00000138 75 B0                           	JNE	L29
   173 0000013A 8B 15 [00000020]                	MOV	EDX,DWORD [_FADT]
   174 00000140 83 7A 30 00                     	CMP	DWORD [48+EDX],0
   175 00000144 74 A4                           	JE	L29
   176 00000146 8A 42 34                        	MOV	AL,BYTE [52+EDX]
   177 00000149 84 C0                           	TEST	AL,AL
   178 0000014B 74 9D                           	JE	L29
   179 0000014D 0F B6 C0                        	MOVZX	EAX,AL
   180 00000150 50                              	PUSH	EAX
   181 00000151 31 F6                           	XOR	ESI,ESI
   182 00000153 FF 72 30                        	PUSH	DWORD [48+EDX]
   183 00000156 E8 [00000000]                   	CALL	_io_out8
   184 0000015B 59                              	POP	ECX
   185 0000015C 5B                              	POP	EBX
   186 0000015D                                 L45:
   187 0000015D A1 [00000020]                   	MOV	EAX,DWORD [_FADT]
   188 00000162 FF 70 40                        	PUSH	DWORD [64+EAX]
   189 00000165 E8 [00000000]                   	CALL	_io_in16
   190 0000016A 5A                              	POP	EDX
   191 0000016B 83 E0 01                        	AND	EAX,1
   192 0000016E 75 16                           	JNE	L36
   193 00000170 BB 000F423F                     	MOV	EBX,999999
   194 00000175                                 L44:
   195 00000175 E8 [00000000]                   	CALL	_io_sti
   196 0000017A 4B                              	DEC	EBX
   197 0000017B 79 F8                           	JNS	L44
   198 0000017D 46                              	INC	ESI
   199 0000017E 81 FE 0000012B                  	CMP	ESI,299
   200 00000184 7E D7                           	JLE	L45
   201 00000186                                 L36:
   202 00000186 A1 [00000020]                   	MOV	EAX,DWORD [_FADT]
   203 0000018B 83 78 44 00                     	CMP	DWORD [68+EAX],0
   204 0000018F 0F 84 FFFFFF55                  	JE	L29
   205 00000195 81 FE 0000012B                  	CMP	ESI,299
   206 0000019B 0F 8F FFFFFF49                  	JG	L29
   207 000001A1                                 L57:
   208 000001A1 A1 [00000020]                   	MOV	EAX,DWORD [_FADT]
   209 000001A6 FF 70 44                        	PUSH	DWORD [68+EAX]
   210 000001A9 E8 [00000000]                   	CALL	_io_in16
   211 000001AE 5B                              	POP	EBX
   212 000001AF 83 E0 01                        	AND	EAX,1
   213 000001B2 0F 85 FFFFFF32                  	JNE	L29
   214 000001B8 BB 000F423F                     	MOV	EBX,999999
   215 000001BD                                 L56:
   216 000001BD E8 [00000000]                   	CALL	_io_sti
   217 000001C2 4B                              	DEC	EBX
   218 000001C3 79 F8                           	JNS	L56
   219 000001C5 46                              	INC	ESI
   220 000001C6 81 FE 0000012B                  	CMP	ESI,299
   221 000001CC 7E D3                           	JLE	L57
   222 000001CE E9 FFFFFF17                     	JMP	L29
   223                                          [SECTION .data]
   224 0000000E                                 LC2:
   225 0000000E 44 53 44 54 00                  	DB	"DSDT",0x00
   226 00000013                                 LC3:
   227 00000013 5F 53 35 5F 00                  	DB	"_S5_",0x00
   228                                          [SECTION .text]
   229 000001D3                                 	GLOBAL	_acpi_shutdown
   230 000001D3                                 _acpi_shutdown:
   231 000001D3 55                              	PUSH	EBP
   232 000001D4 89 E5                           	MOV	EBP,ESP
   233 000001D6 57                              	PUSH	EDI
   234 000001D7 56                              	PUSH	ESI
   235 000001D8 53                              	PUSH	EBX
   236 000001D9 83 EC 0C                        	SUB	ESP,12
   237 000001DC E8 [00000000]                   	CALL	_io_cli
   238 000001E1 68 00269000                     	PUSH	2527232
   239 000001E6 E8 [00000000]                   	CALL	_store_cr3
   240 000001EB 68 [0000000E]                   	PUSH	LC2
   241 000001F0 E8 FFFFFE75                     	CALL	_acpi_find_table
   242 000001F5 C7 45 EC 00000000               	MOV	DWORD [-20+EBP],0
   243 000001FC 8B 58 04                        	MOV	EBX,DWORD [4+EAX]
   244 000001FF 89 45 E8                        	MOV	DWORD [-24+EBP],EAX
   245 00000202 83 EB 24                        	SUB	EBX,36
   246 00000205 58                              	POP	EAX
   247 00000206 C1 EB 02                        	SHR	EBX,2
   248 00000209 5A                              	POP	EDX
   249 0000020A 39 5D EC                        	CMP	DWORD [-20+EBP],EBX
   250 0000020D 7D 21                           	JGE	L72
   251 0000020F                                 L71:
   252 0000020F BA [00000013]                   	MOV	EDX,LC3
   253 00000214 B8 00000004                     	MOV	EAX,4
   254 00000219 FC                              	CLD
   255 0000021A 8B 75 E8                        	MOV	ESI,DWORD [-24+EBP]
   256 0000021D 89 D7                           	MOV	EDI,EDX
   257 0000021F 89 C1                           	MOV	ECX,EAX
   258 00000221 F3                              	REPE
   259 00000222 A6                              	CMPSB
   260 00000223 74 18                           	JE	L67
   261 00000225 FF 45 EC                        	INC	DWORD [-20+EBP]
   262 00000228 FF 45 E8                        	INC	DWORD [-24+EBP]
   263 0000022B 39 5D EC                        	CMP	DWORD [-20+EBP],EBX
   264 0000022E 7C DF                           	JL	L71
   265 00000230                                 L72:
   266 00000230 8D 65 F4                        	LEA	ESP,DWORD [-12+EBP]
   267 00000233 B8 00000001                     	MOV	EAX,1
   268 00000238 5B                              	POP	EBX
   269 00000239 5E                              	POP	ESI
   270 0000023A 5F                              	POP	EDI
   271 0000023B 5D                              	POP	EBP
   272 0000023C C3                              	RET
   273 0000023D                                 L67:
   274 0000023D 39 5D EC                        	CMP	DWORD [-20+EBP],EBX
   275 00000240 7D EE                           	JGE	L72
   276 00000242 8B 55 E8                        	MOV	EDX,DWORD [-24+EBP]
   277 00000245 8A 42 FF                        	MOV	AL,BYTE [-1+EDX]
   278 00000248 3C 08                           	CMP	AL,8
   279 0000024A 74 47                           	JE	L74
   280 0000024C 80 7A FE 08                     	CMP	BYTE [-2+EDX],8
   281 00000250 74 3D                           	JE	L79
   282 00000252                                 L73:
   283 00000252 66 81 4D F2 2000                	OR	WORD [-14+EBP],8192
   284 00000258 0F B7 45 F2                     	MOVZX	EAX,WORD [-14+EBP]
   285 0000025C 50                              	PUSH	EAX
   286 0000025D A1 [00000020]                   	MOV	EAX,DWORD [_FADT]
   287 00000262 FF 70 40                        	PUSH	DWORD [64+EAX]
   288 00000265 E8 [00000000]                   	CALL	_io_out16
   289 0000026A 5F                              	POP	EDI
   290 0000026B 8B 15 [00000020]                	MOV	EDX,DWORD [_FADT]
   291 00000271 58                              	POP	EAX
   292 00000272 83 7A 44 00                     	CMP	DWORD [68+EDX],0
   293 00000276 74 B8                           	JE	L72
   294 00000278 66 81 4D F0 2000                	OR	WORD [-16+EBP],8192
   295 0000027E 0F B7 45 F0                     	MOVZX	EAX,WORD [-16+EBP]
   296 00000282 50                              	PUSH	EAX
   297 00000283 FF 72 44                        	PUSH	DWORD [68+EDX]
   298 00000286 E8 [00000000]                   	CALL	_io_out16
   299 0000028B 5B                              	POP	EBX
   300 0000028C 5E                              	POP	ESI
   301 0000028D EB A1                           	JMP	L72
   302 0000028F                                 L79:
   303 0000028F 3C 5C                           	CMP	AL,92
   304 00000291 75 BF                           	JNE	L73
   305 00000293                                 L74:
   306 00000293 8B 4D E8                        	MOV	ECX,DWORD [-24+EBP]
   307 00000296 80 79 04 12                     	CMP	BYTE [4+ECX],18
   308 0000029A 75 B6                           	JNE	L73
   309 0000029C 83 C1 05                        	ADD	ECX,5
   310 0000029F 0F BE 01                        	MOVSX	EAX,BYTE [ECX]
   311 000002A2 25 000000C0                     	AND	EAX,192
   312 000002A7 C1 F8 06                        	SAR	EAX,6
   313 000002AA 01 C8                           	ADD	EAX,ECX
   314 000002AC 8D 78 02                        	LEA	EDI,DWORD [2+EAX]
   315 000002AF 89 7D E8                        	MOV	DWORD [-24+EBP],EDI
   316 000002B2 80 78 02 0A                     	CMP	BYTE [2+EAX],10
   317 000002B6 74 32                           	JE	L80
   318 000002B8                                 L75:
   319 000002B8 8B 45 E8                        	MOV	EAX,DWORD [-24+EBP]
   320 000002BB 66 0F BE 00                     	MOVSX	AX,BYTE [EAX]
   321 000002BF C1 E0 0A                        	SAL	EAX,10
   322 000002C2 FF 45 E8                        	INC	DWORD [-24+EBP]
   323 000002C5 66 89 45 F2                     	MOV	WORD [-14+EBP],AX
   324 000002C9 8B 55 E8                        	MOV	EDX,DWORD [-24+EBP]
   325 000002CC 80 3A 0A                        	CMP	BYTE [EDX],10
   326 000002CF 74 13                           	JE	L81
   327 000002D1                                 L76:
   328 000002D1 8B 4D E8                        	MOV	ECX,DWORD [-24+EBP]
   329 000002D4 66 0F BE 09                     	MOVSX	CX,BYTE [ECX]
   330 000002D8 C1 E1 0A                        	SAL	ECX,10
   331 000002DB 66 89 4D F0                     	MOV	WORD [-16+EBP],CX
   332 000002DF E9 FFFFFF6E                     	JMP	L73
   333 000002E4                                 L81:
   334 000002E4 42                              	INC	EDX
   335 000002E5 89 55 E8                        	MOV	DWORD [-24+EBP],EDX
   336 000002E8 EB E7                           	JMP	L76
   337 000002EA                                 L80:
   338 000002EA 83 C0 03                        	ADD	EAX,3
   339 000002ED 89 45 E8                        	MOV	DWORD [-24+EBP],EAX
   340 000002F0 EB C6                           	JMP	L75
   341 000002F2                                 	GLOBAL	_RSDP
   342                                          [SECTION .data]
   343 00000018                                 	ALIGNB	4
   344 00000018                                 _RSDP:
   345 00000018 00 00 00 00                     	RESB	4
   346 0000001C                                 	GLOBAL	_RSDT
   347                                          [SECTION .data]
   348 0000001C                                 	ALIGNB	4
   349 0000001C                                 _RSDT:
   350 0000001C 00 00 00 00                     	RESB	4
   351 00000020                                 	GLOBAL	_FADT
   352                                          [SECTION .data]
   353 00000020                                 	ALIGNB	4
   354 00000020                                 _FADT:
   355 00000020 00 00 00 00                     	RESB	4
