     1 00000000                                 ; haribote-os boot asm
     2 00000000                                 ; TAB=4
     3 00000000                                 
     4 00000000                                 [INSTRSET "i486p"]
     5 00000000                                 
     6 00000000                                 ; bootpack的启动
     7 00000000                                 		[bits 32]
     8 00000000 89 E5                           		mov 	EBP,ESP
     9 00000002 BB 00280070                     		MOV		EBX,bootpack+0x280000
    10 00000007 8B 4B 10                        		MOV		ECX,[EBX+16];数据段大小
    11 0000000A 83 C1 03                        		ADD		ECX,3			; ECX += 3;
    12 0000000D C1 E9 02                        		SHR		ECX,2			; ECX /= 4;
    13 00000010 74 0D                           		JZ		skip			; 没有要传送的数据
    14 00000012 8B 73 14                        		MOV		ESI,[EBX+20]	; 数据开始部分
    15 00000015 01 DE                           		ADD		ESI,EBX
    16 00000017 8B 7B 0C                        		MOV		EDI,[EBX+12]	; esp初始值
    17 0000001A E8 00000013                     		CALL	memcpy
    18 0000001F                                 		
    19 0000001F                                 skip:
    20 0000001F 8B 63 0C                        		MOV		ESP,[EBX+12]	; esp初期値
    21 00000022 FF 75 04                        		push  	dword[ebp+4]		;传入参数
    22 00000025 68 00280070                     		push 	dword bootpack+0x280000
    23 0000002A B8 0028008B                     		mov eax,0x28001b+bootpack;
    24 0000002F FF D0                           		call	eax
    25 00000031                                 		;LGDT [GDTR0]
    26 00000031                                 		;jmp far 0x10:0x1b
    27 00000031 C3                              		ret
    28 00000032                                 memcpy:
    29 00000032 8B 06                           		MOV		EAX,[ESI]
    30 00000034 83 C6 04                        		ADD		ESI,4
    31 00000037 89 07                           		MOV		[EDI],EAX
    32 00000039 83 C7 04                        		ADD		EDI,4
    33 0000003C 83 E9 01                        		SUB		ECX,1
    34 0000003F 75 F1                           		JNZ		memcpy			; 引き算した結果が0でなければmemcpyへ
    35 00000041 C3                              		RET
    36 00000042 00 00 00 00 00 00 00 00 00 00   		ALIGNB	16
       0000004C 00 00 00 00 
    37 00000050                                 GDT0:
    38 00000050 00 00 00 00 00 00 00 00         		RESB	8				; ヌルセレクタ
    39 00000058 FFFF 0000 9200 00CF             		DW		0xffff,0x0000,0x9200,0x00cf	; 読み書き可能セグメント32bit
    40 00000060 FFFF 0000 9A28 0047             		DW		0xffff,0x0000,0x9a28,0x0047	; 実行可能セグメント32bit（bootpack用）
    41 00000068 0000                            		DW		0
    42 0000006A                                 GDTR0:
    43 0000006A 0017                            		DW		8*3-1
    44 0000006C 00000050                        		DD		GDT0
    45 00000070                                 		ALIGNB	16
    46 00000070                                 bootpack:
